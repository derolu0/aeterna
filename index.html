<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aeterna Lexicon in Motu - Dataset Filosofico</title>
    
    <!-- Metadati -->
    <meta name="description" content="Dataset per l'analisi delle trasformazioni del linguaggio filosofico tra classico e contemporaneo">
    <meta name="theme-color" content="#3b82f6">
    
    <!-- Manifest PWA -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    
    <!-- Font e Librerie -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Fogli di stile -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="comparative-styles.css">
    
    <!-- Script esterni -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* Smooth scroll per ancore */
        html {
            scroll-behavior: smooth;
        }
        
        /* Stili temporanei per le immagini mancanti */
        .item-image {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }
        
        .compact-image-fallback {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- ==================== SPLASH SCREEN ==================== -->
    <div id="splash-screen">
        <div class="splash-container">
            <img src="images/icona-avvio-splash.png" alt="Aeterna Lexicon" class="splash-image">
            <div class="splash-progress">
                <div class="splash-progress-bar"></div>
            </div>
            <p class="splash-text">Caricamento dataset filosofico...</p>
        </div>
    </div>

    <!-- ==================== INDICATORI ==================== -->
    <div class="offline-indicator" id="offline-indicator">
        <i class="fas fa-wifi"></i> Connessione assente
    </div>
    
    <div class="toast" id="toast"></div>

    <!-- ==================== AUTENTICAZIONE ADMIN ==================== -->
    <div class="auth-overlay" id="admin-auth">
        <div class="auth-modal">
            <h2 class="auth-title">Accesso Amministratore</h2>
            <input type="email" class="auth-input" id="admin-email" placeholder="Email">
            <input type="password" class="auth-input" id="admin-password" placeholder="Password" autocomplete="off">
            <button class="auth-btn" onclick="checkAdminAuth()">Accedi</button>
            <div class="auth-error" id="auth-error" style="display: none;">Credenziali non valide</div>
            <button class="auth-btn secondary" onclick="closeAdminAuth()">Annulla</button>
        </div>
    </div>

    <!-- ==================== MODALI VARIE ==================== -->
    <div class="modal-overlay" id="info-modal">
        <div class="modal-content">
            <h3 class="modal-title">Informazioni</h3>
            <p id="info-modal-message"></p>
            <div class="modal-buttons">
                <button class="modal-btn primary" onclick="closeInfoModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- ==================== MODALE ANALISI COMPARATIVA ==================== -->
    <div class="modal-overlay" id="comparative-analysis-modal">
        <div class="modal-content comparative-modal">
            <div class="comparative-header">
                <h2 id="comparative-term-title">CONCETTO</h2>
                <div class="term-origins">
                    <span class="origin-badge">Origine Classica</span>
                    <span class="origin-arrow">‚Üí</span>
                    <span class="origin-badge">Evoluzione Contemporanea</span>
                </div>
            </div>
            
            <div class="timeline-container" id="evolution-timeline">
                <!-- Timeline dinamica -->
                <div class="analisi-loading">
                    <div class="analisi-spinner"></div>
                    <p>Caricamento evoluzione storica...</p>
                </div>
            </div>
            
            <div class="comparative-columns">
                <div class="compare-column classico-col">
                    <h3><i class="fas fa-columns"></i> PERIODO CLASSICO</h3>
                    <div class="text-analysis">
                        <h4>Testo Originale</h4>
                        <div class="original-text" id="classical-original-text">
                            Testo in caricamento...
                        </div>
                        <h4>Analisi Linguistica</h4>
                        <div class="linguistic-metrics" id="classical-metrics">
                            <!-- Metriche dinamiche -->
                        </div>
                        <h4>Definizione Canonica</h4>
                        <p class="definition" id="classical-definition">
                            Definizione in caricamento...
                        </p>
                    </div>
                </div>
                
                <div class="compare-column contemporaneo-col">
                    <h3><i class="fas fa-bolt"></i> PERIODO CONTEMPORANEO</h3>
                    <div class="text-analysis">
                        <h4>Testo Originale</h4>
                        <div class="original-text" id="contemporary-original-text">
                            Testo in caricamento...
                        </div>
                        <h4>Analisi Linguistica</h4>
                        <div class="linguistic-metrics" id="contemporary-metrics">
                            <!-- Metriche dinamiche -->
                        </div>
                        <h4>Definizione Canonica</h4>
                        <p class="definition" id="contemporary-definition">
                            Definizione in caricamento...
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="transformations-table">
                <h3><i class="fas fa-exchange-alt"></i> TRASFORMAZIONI IDENTIFICATE</h3>
                <div id="transformations-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Dimensione</th>
                                <th>Classico ‚Üí Contemporaneo</th>
                                <th>Svolta Storica</th>
                            </tr>
                        </thead>
                        <tbody id="transformations-body">
                            <!-- Trasformazioni dinamiche -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="comparative-actions">
                <button class="btn-analisi" onclick="exportComparativeAnalysis()">
                    <i class="fas fa-download"></i> Esporta Analisi
                </button>
                <button class="btn-secondary" onclick="closeComparativeModal()">
                    <i class="fas fa-times"></i> Chiudi
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== CONTAINER PRINCIPALE APP ==================== -->
    <div class="app-container">
        <!-- Pulsante Menu -->
        <div class="admin-icon-btn-container">
            <button class="admin-icon-btn" onclick="toggleMenuModal()">
                <i class="fas fa-ellipsis-v"></i>
            </button>
        </div>

        <!-- ============ SCHERMATA HOME ============ -->
        <div class="screen active" id="home-screen">
            <div class="logo-container">
                <div class="app-logo logo-with-image"></div>
                <div class="comune-logo"></div>
            </div>
            
            <p class="home-welcome-animated">AETERNA</p>
    
            <h1 class="home-title">Lexicon in Motu</h1>
    
            <p class="home-subtitle">
                Dataset per l'analisi delle trasformazioni<br>
                del linguaggio filosofico tra classico e contemporaneo
            </p>   
    
            <div class="home-buttons">
                <div class="button-row">
                    <button class="home-btn filosofi-btn" onclick="showScreen('filosofi-screen')">
                        <span class="btn-icon"><i class="fas fa-user-graduate"></i></span>
                        <span class="btn-text">Filosofi</span>
                    </button>
                    <button class="home-btn opere-btn" onclick="showScreen('opere-screen')">
                        <span class="btn-icon"><i class="fas fa-book"></i></span>
                        <span class="btn-text">Opere</span>
                    </button>
                </div>
                <div class="button-row">
                    <button class="home-btn mappa-btn" onclick="showScreen('mappa-screen')">
                        <span class="btn-icon"><i class="fas fa-map-marked-alt"></i></span>
                        <span class="btn-text">Mappa Geografica</span>
                    </button>
                    <button class="home-btn concetti-btn" onclick="showScreen('concetti-screen')">
                        <span class="btn-icon"><i class="fas fa-brain"></i></span>
                        <span class="btn-text">Concetti</span>
                    </button>
                </div>
                <div class="button-row">
                    <button class="home-btn network-btn" onclick="showScreen('mappa-concettuale-screen')">
                        <span class="btn-icon"><i class="fas fa-project-diagram"></i></span>
                        <span class="btn-text">Mappa Concettuale</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ============ SCHERMATA FILOSOFI ============ -->
        <div class="screen list-screen" id="filosofi-screen">
            <header class="app-header">
                <button class="back-btn" onclick="goBack()"><i class="fas fa-arrow-left"></i></button>
                <h1 class="screen-title">Filosofi</h1>
                <p class="screen-subtitle">Esplora i filosofi della storia</p>
            </header>
    
            <div class="search-container">
                <input type="text" class="search-input" placeholder="üîç Cerca filosofi..." 
                       onkeyup="searchFilosofi(this.value)">
            </div>
    
            <div class="content-area">
                <div class="filter-buttons">
                    <button class="filter-btn all active" onclick="setFilter('all')">
                        <i class="fas fa-layer-group"></i> Tutti
                    </button>
                    <button class="filter-btn funzionante" onclick="setFilter('classico')">
                        <i class="fas fa-columns"></i> Classici
                    </button>
                    <button class="filter-btn non-funzionante" onclick="setFilter('contemporaneo')">
                        <i class="fas fa-bolt"></i> Contemporanei
                    </button>
                </div>
        
                <div class="items-grid" id="filosofi-list">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Caricamento filosofi...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============ SCHERMATA OPERE ============ -->
        <div class="screen list-screen" id="opere-screen">
            <header class="app-header">
                <button class="back-btn" onclick="goBack()"><i class="fas fa-arrow-left"></i></button>
                <h1 class="screen-title">Opere</h1>
                <p class="screen-subtitle">Scopri le opere filosofiche</p>
            </header>
    
            <div class="search-container">
                <input type="text" class="search-input" placeholder="üîç Cerca opere..." 
                       onkeyup="searchOpere(this.value)">
            </div>
    
            <div class="content-area">
                <div class="filter-buttons">
                    <button class="filter-btn all active" onclick="setFilterOpere('all')">
                        <i class="fas fa-layer-group"></i> Tutte
                    </button>
                    <button class="filter-btn funzionante" onclick="setFilterOpere('classico')">
                        <i class="fas fa-columns"></i> Classiche
                    </button>
                    <button class="filter-btn non-funzionante" onclick="setFilterOpere('contemporaneo')">
                        <i class="fas fa-bolt"></i> Contemporanee
                    </button>
                </div>
        
                <div class="compact-items-list" id="opere-list">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Caricamento opere...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============ SCHERMATA CONCETTI ============ -->
        <div class="screen list-screen" id="concetti-screen">
            <header class="app-header">
                <button class="back-btn" onclick="goBack()"><i class="fas fa-arrow-left"></i></button>
                <h1 class="screen-title">Concetti</h1>
                <p class="screen-subtitle">Analizza le parole chiave della filosofia</p>
            </header>
            
            <div class="content-area">
                <div class="concetti-container" id="concetti-list">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Caricamento concetti...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============ DETTAGLIO FILOSOFO ============ -->
        <div class="screen detail-screen" id="filosofo-detail-screen">
            <header class="app-header">
                <button class="back-btn" onclick="goBack()"><i class="fas fa-arrow-left"></i></button>
                <h1 class="screen-title">Filosofo</h1>
            </header>
            <div class="detail-content" id="filosofo-detail-content">
                <div class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>

        <!-- ============ DETTAGLIO OPERA ============ -->
        <div class="screen detail-screen" id="opera-detail-screen">
            <header class="app-header">
                <button class="back-btn" onclick="goBack()"><i class="fas fa-arrow-left"></i></button>
                <h1 class="screen-title">Opera</h1>
            </header>
            <div class="detail-content" id="opera-detail-content">
                <div class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>

        <!-- ============ DETTAGLIO CONCETTO ============ -->
        <div class="screen detail-screen" id="concetto-detail-screen">
            <header class="app-header">
                <button class="back-btn" onclick="goBack()"><i class="fas fa-arrow-left"></i></button>
                <h1 class="screen-title">Concetto</h1>
            </header>
            <div class="detail-content" id="concetto-detail-content">
                <div class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>

        <!-- ============ MAPPA GEOGRAFICA ============ -->
        <div class="screen" id="mappa-screen">
            <header class="app-header">
                <button class="back-btn" onclick="goBack()"><i class="fas fa-arrow-left"></i></button>
                <h1 class="screen-title">Mappa Geografica</h1>
            </header>
    
            <div class="map-search-container">
                <div class="map-search-box">
                    <input type="text" id="map-search-input" placeholder="üîç Cerca filosofo o luogo..."
                           onkeypress="handleMapSearch(event)">
                    <button class="map-search-btn" onclick="performMapSearch()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="search-results" id="map-search-results"></div>
            </div>
    
            <div id="map" class="map-container"></div>
    
            <div class="map-legend">
                <div class="legend-title">Legenda</div>
                <div class="legend-item">
                    <div class="legend-icon icon-filosofo-classico"></div>
                    <span>Filosofo Classico</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon icon-filosofo-contemporaneo"></div>
                    <span>Filosofo Contemporaneo</span>
                </div>
            </div>
        </div>

        <!-- ============ MAPPA CONCETTUALE ============ -->
        <div class="screen" id="mappa-concettuale-screen">
            <header class="app-header">
                <button class="back-btn" onclick="goBack()"><i class="fas fa-arrow-left"></i></button>
                <h1 class="screen-title">Mappa Concettuale</h1>
                <p class="screen-subtitle">Visualizza le connessioni tra filosofi e concetti</p>
            </header>

            <div class="content-area">
                <div class="concetto-controls">
                    <div class="filter-buttons">
                        <button class="filter-btn all active" onclick="filterConceptMap('tutti')">
                            <i class="fas fa-layer-group"></i> Tutti
                        </button>
                        <button class="filter-btn funzionante" onclick="filterConceptMap('classico')">
                            <i class="fas fa-columns"></i> Classici
                        </button>
                        <button class="filter-btn non-funzionante" onclick="filterConceptMap('contemporaneo')">
                            <i class="fas fa-bolt"></i> Contemporanei
                        </button>
                    </div>
                </div>

                <div id="concept-network" style="width: 100%; height: 600px; border: 1px solid #e5e7eb; border-radius: 12px;">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Costruzione mappa concettuale...</p>
                    </div>
                </div>
            </div>
        </div>                 
         
        <!-- ============ CREDITS ============ -->
        <div id="credits-screen" class="screen">
            <header class="app-header" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
                <button class="back-btn" onclick="showScreen('home-screen')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="screen-title" style="color: white;">Info & Credits</div>
            </header>

            <div class="content-area" style="padding: 20px; display: flex; flex-direction: column; align-items: center;">
                
                <div style="text-align: center; margin-bottom: 30px; max-width: 500px; width: 100%;">
                    <img src="images/logo-app.png" alt="Aeterna Lexicon" 
                         style="width: 80px; height: 80px; border-radius: 20px; margin-bottom: 10px;">
                    <h2 style="font-size: 1.3rem; color: #1f2937; margin-bottom: 5px;">
                        Aeterna Lexicon in Motu
                    </h2>
                    <p style="color: #6b7280; font-size: 0.9rem;">v. 4.0.0</p>
                </div>

                <hr style="margin: 20px 0; border-color: #e5e7eb; width: 100%; max-width: 500px;">

                <div class="credit-section" style="margin-bottom: 30px; max-width: 500px; width: 100%;">
                    <h4 style="color: #3b82f6; font-size: 0.85rem; margin-bottom: 8px; font-weight: 600; text-align: center;">
                        AUTORE & PROJECT
                    </h4>
                    
                    <p style="font-weight: 700; font-size: 1.1rem; color: #1f2937; margin-bottom: 4px; text-align: center;">
                        De Rosa Salvatore
                    </p>
                    
                    <p style="font-size: 0.95rem; color: #4b5563; margin-bottom: 2px; text-align: center;">
                        Corso di Laurea in Filosofia ed Etica
                    </p>
                    
                    <p style="font-size: 0.9rem; color: #6b7280; margin-bottom: 12px; text-align: center;">
                        Universit√† Telematica Pegaso (Unipegaso)<br>
                        Anno Accademico 2025/2026
                    </p>

                    <div style="background-color: #f0f9ff; padding: 12px; border-radius: 8px; border-left: 4px solid #3b82f6; text-align: center;">
                        <p style="font-size: 0.85rem; color: #334155; line-height: 1.5;">
                            "Project Work per l'analisi delle trasformazioni del linguaggio filosofico 
                            tra periodo classico e contemporaneo."
                        </p>
                    </div>
                </div>

                <hr style="margin: 20px 0; border-color: #e5e7eb; width: 100%; max-width: 500px;">

                <div style="font-size: 0.75rem; color: #9ca3af; line-height: 1.5; max-width: 500px; width: 100%; text-align: center;">
                    <p style="margin-bottom: 10px;">
                        Applicativo sviluppato per il <strong>Project Work Universitario</strong> 
                        sulla trasformazione del linguaggio filosofico.
                    </p>
                    <p style="font-weight: 600; color: #3b82f6; margin-bottom: 15px;">
                        Dataset filosofico comparativo Classico/Contemporaneo
                    </p>
                    
                    <div style="background: #f3f4f6; padding: 12px; border-radius: 10px; margin-bottom: 15px; text-align: center;">
                        <p style="font-weight: 600; margin-bottom: 8px; color: #4b5563;">
                            Tecnologie utilizzate:
                        </p>
                        <p>Leaflet Maps, OpenStreetMap, vis.js</p>
                        <p>Firebase Firestore, GitHub Pages</p>
                    </div>
                    
                    <p style="margin-top: 15px; line-height: 1.4;">
                        Software ¬© 2026 <strong>Salvatore De Rosa</strong>.<br>
                        Dataset ¬© 2026 <strong>Project Work Aeterna Lexicon</strong>.
                    </p>
                    
                    <!-- Contatto generico (senza email specifica) -->
                    <div style="background: #e0f2fe; padding: 12px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #0ea5e9; text-align: center;">
                        <p style="font-weight: 600; margin-bottom: 5px; color: #0369a1;">
                            <i class="fas fa-info-circle"></i> Informazioni
                        </p>
                        <p style="color: #0c4a6e; font-size: 0.8rem;">
                            Per segnalazioni o informazioni, utilizzare il modulo dedicato nell'app.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============ SEGNALAZIONI ============ -->
        <div id="segnalazioni-screen" class="screen">
            <header class="app-header" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                <button class="back-btn" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 class="screen-title" style="color: white;">Segnalazioni</h1>
                <p class="screen-subtitle" style="color: rgba(255,255,255,0.9);">Inviaci feedback sul dataset filosofico</p>
            </header>

            <div class="content-area">
                <div class="report-container" style="padding: 20px;">
                    <p style="margin-bottom: 20px; color: #6b7280;">
                        <i class="fas fa-info-circle" style="color: #ef4444; margin-right: 5px;"></i>
                        Hai trovato un'inesattezza in un concetto o un problema nell'App? 
                        La tua segnalazione aiuter√† a migliorare il dataset.
                    </p>

                    <form onsubmit="inviaSegnalazione(event)" class="report-form">
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #4b5563; font-weight: 500;">Tipo di Segnalazione</label>
                            <select id="report-type" class="search-input" required 
                                    style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white;">
                                <option value="Dato inesatto">Dato inesatto</option>
                                <option value="Errore testo">Errore nel testo</option>
                                <option value="Bug App">Problema tecnico</option>
                                <option value="Suggerimento">Suggerimento</option>
                            </select>
                        </div>

                        <div class="form-group" style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; color: #4b5563; font-weight: 500;">Descrizione</label>
                            <textarea id="report-desc" class="search-input" rows="4"
                                      placeholder="Descrivi il problema riscontrato..." required
                                      style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white;"></textarea>
                        </div>

                        <button type="submit" class="home-btn network-btn" 
                                style="width: 100%; margin-top: 20px; background: linear-gradient(135deg, #ef4444, #dc2626); border: none; color: white; padding: 15px; border-radius: 12px; font-weight: 600;">
                            <span class="btn-icon"><i class="fas fa-paper-plane"></i></span>
                            <span class="btn-text">Invia Segnalazione</span>
                        </button>
                    </form>
                    
                    <div style="margin-top: 25px; padding: 15px; background: #fef2f2; border-radius: 10px; border-left: 4px solid #ef4444;">
                        <p style="color: #7f1d1d; font-size: 0.85rem; line-height: 1.5;">
                            <i class="fas fa-clock" style="margin-right: 5px;"></i>
                            Le segnalazioni vengono raccolte per migliorare il dataset. 
                            Non possiamo garantire una risposta immediata, ma tutte le segnalazioni vengono esaminate.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============ TAB BAR ============ -->
        <div class="tab-bar">
            <button class="tab-btn active" data-target="home-screen" onclick="showScreen('home-screen')">
                <span class="tab-icon"><i class="fas fa-home"></i></span>
                <span>Home</span>
            </button>
            <button class="tab-btn" data-target="filosofi-screen" onclick="showScreen('filosofi-screen')">
                <span class="tab-icon"><i class="fas fa-user-graduate"></i></span>
                <span>Filosofi</span>
            </button>
            <button class="tab-btn" data-target="opere-screen" onclick="showScreen('opere-screen')">
                <span class="tab-icon"><i class="fas fa-book"></i></span>
                <span>Opere</span>
            </button>
            <button class="tab-btn" data-target="mappa-screen" onclick="showScreen('mappa-screen')">
                <span class="tab-icon"><i class="fas fa-map-marked-alt"></i></span>
                <span>Mappa</span>
            </button>
            <button class="tab-btn" data-target="concetti-screen" onclick="showScreen('concetti-screen')">
                <span class="tab-icon"><i class="fas fa-brain"></i></span>
                <span>Concetti</span>
            </button>
        </div>
    </div>

    <!-- ==================== MENU OVERLAY ==================== -->
    <div id="top-menu-modal" class="modal-overlay" onclick="closeMenuModal(event)">
        <div class="modal-content menu-modal-content" onclick="event.stopPropagation()">
            <h3 class="modal-title">Menu</h3>
            
            <div class="modal-buttons">
                <button class="modal-btn btn-info" onclick="openCreditsScreen()">
                    <i class="fas fa-info-circle"></i>
                    <span>Info & Crediti</span>
                </button>
                
                <button class="modal-btn btn-qr" onclick="openQRModal()">
                    <i class="fas fa-qrcode"></i>
                    <span>Condividi App</span>
                </button>

                <button class="modal-btn btn-report" onclick="openReportScreen()">
                    <i class="fas fa-bullhorn"></i>
                    <span>Segnala Errore</span>
                </button>

                <button class="modal-btn" onclick="closeMenuModal()">
                    <i class="fas fa-times"></i>
                    <span>Chiudi</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== MODALE QR ==================== -->
    <div id="qr-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title">Condividi l'App</h3>
            
            <div id="qrcode-container" style="margin: 20px auto; padding: 10px; background: white;"></div>
            
            <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">
                Scansiona per aprire l'app Aeterna Lexicon
            </p>
            
            <button class="modal-btn" onclick="closeQRModal()">
                Chiudi
            </button>
        </div>
    </div>

    <!-- ==================== BANNER INSTALLAZIONE PWA ==================== -->
    <div id="pwa-install-banner" class="pwa-banner" style="display: none;">
        <div class="pwa-content">
            <img src="images/icona-avvio-192.png" alt="Logo" class="pwa-icon" onerror="this.style.display='none'">
            <div class="pwa-text">
                <strong>Installa Aeterna Lexicon</strong>
                <span>Accedi al dataset offline</span>
            </div>
        </div>
        <button onclick="installPWA()" class="pwa-btn">Installa</button>
        <button onclick="document.getElementById('pwa-install-banner').style.display='none'" class="pwa-close">&times;</button>
    </div>

    <!-- ==================== PANNELLO ADMIN (Semplificato per dati integrati) ==================== -->
    <div id="admin-panel" class="screen" style="display: none;">
        <div class="admin-header">
            <h2><i class="fas fa-cogs"></i> Gestione Dataset</h2>
            <button class="close-btn" onclick="closeAdminPanel()"><i class="fas fa-times"></i></button>
        </div>
    
        <div class="admin-content">
            <div class="admin-stats">
                <div class="stat-card">
                    <h3>Filosofi</h3>
                    <span id="total-filosofi">20</span>
                </div>
                <div class="stat-card">
                    <h3>Opere</h3>
                    <span id="total-opere">40</span>
                </div>
                <div class="stat-card">
                    <h3>Concetti</h3>
                    <span id="total-concetti">23</span>
                </div>
            </div>
            
            <div class="admin-controls">
                <button class="btn-primary" onclick="exportFullDataset()"><i class="fas fa-download"></i> Scarica Tutto (Backup)</button>
            </div>
    
            <div class="admin-tabs">
                <button class="admin-tab-btn active" onclick="switchAdminTab('admin-filosofi')">Filosofi</button>
                <button class="admin-tab-btn" onclick="switchAdminTab('admin-opere')">Opere</button>
                <button class="admin-tab-btn" onclick="switchAdminTab('admin-concetti')">Concetti</button>
            </div>
    
            <div id="admin-filosofi" class="admin-tab-content active">
                <div class="toolbar">
                    <h3>Esporta CSV</h3>
                    <div class="import-export-group">
                        <button class="btn-secondary" onclick="exportFilosofiToExcel()"><i class="fas fa-file-download"></i> Esporta CSV</button>
                    </div>
                </div>
    
                <div class="data-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Periodo</th>
                                <th>Scuola</th>
                                <th>Anni</th>
                                <th>Opere</th>
                            </tr>
                        </thead>
                        <tbody id="filosofi-table-body">
                            <!-- Popolato da JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
    
            <div id="admin-opere" class="admin-tab-content">
                <div class="toolbar">
                    <div class="import-export-group">
                        <button class="btn-secondary" onclick="exportOpereToExcel()"><i class="fas fa-file-download"></i> Esporta CSV</button>
                    </div>
                </div>
    
                <div class="data-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Titolo</th>
                                <th>Autore</th>
                                <th>Anno</th>
                                <th>Periodo</th>
                            </tr>
                        </thead>
                        <tbody id="opere-table-body">
                            <!-- Popolato da JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
    
            <div id="admin-concetti" class="admin-tab-content">
                <div class="toolbar">
                    <div class="import-export-group">
                        <button class="btn-secondary" onclick="exportConcettiToExcel()"><i class="fas fa-file-download"></i> Esporta CSV</button>
                    </div>
                </div>
    
                <div class="data-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Parola</th>
                                <th>Definizione</th>
                                <th>Periodo</th>
                                <th>Evoluzione</th>
                            </tr>
                        </thead>
                        <tbody id="concetti-table-body">
                            <!-- Popolato da JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== SCRIPT ==================== -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    
    <!-- Script dell'app -->
    <script src="firebase-init.js"></script>
    <script src="linguistic-analysis.js"></script>
    <script src="comparative-data.js"></script>
    <script src="app.js"></script>
    
    <script>
        // Funzioni admin semplificate per dati integrati
        function loadAdminFilosofi() {
            const tableBody = document.getElementById('filosofi-table-body');
            if (!tableBody) return;
            
            tableBody.innerHTML = window.filosofiData ? window.filosofiData.map(f => {
                // Conta opere di questo filosofo
                const opereCount = window.opereData ? window.opereData.filter(o => o.autore_id === f.id).length : 0;
                
                return `
                    <tr>
                        <td>${f.id}</td>
                        <td><strong>${f.nome}</strong></td>
                        <td><span class="periodo-badge periodo-${f.periodo}">${f.periodo}</span></td>
                        <td>${f.scuola || '-'}</td>
                        <td>${f.anni || '-'}</td>
                        <td>${opereCount} opere</td>
                    </tr>
                `;
            }).join('') : '<tr><td colspan="6">Nessun dato disponibile</td></tr>';
        }
        
        function loadAdminOpere() {
            const tableBody = document.getElementById('opere-table-body');
            if (!tableBody) return;
            
            tableBody.innerHTML = window.opereData ? window.opereData.map(o => {
                return `
                    <tr>
                        <td>${o.id}</td>
                        <td><strong>${o.titolo}</strong></td>
                        <td>${o.autore}</td>
                        <td>${o.anno}</td>
                        <td><span class="periodo-badge periodo-${o.periodo}">${o.periodo}</span></td>
                    </tr>
                `;
            }).join('') : '<tr><td colspan="5">Nessun dato disponibile</td></tr>';
        }
        
        function loadAdminConcetti() {
            const tableBody = document.getElementById('concetti-table-body');
            if (!tableBody) return;
            
            tableBody.innerHTML = window.concettiData ? window.concettiData.map(c => {
                const evoluzioneBreve = c.evoluzione ? (c.evoluzione.length > 50 ? c.evoluzione.substring(0, 50) + '...' : c.evoluzione) : '-';
                
                return `
                    <tr>
                        <td>${c.id}</td>
                        <td><strong>${c.parola}</strong></td>
                        <td>${c.definizione ? (c.definizione.length > 30 ? c.definizione.substring(0, 30) + '...' : c.definizione) : '-'}</td>
                        <td><span class="periodo-badge periodo-${c.periodo}">${c.periodo}</span></td>
                        <td>${evoluzioneBreve}</td>
                    </tr>
                `;
            }).join('') : '<tr><td colspan="5">Nessun dato disponibile</td></tr>';
        }
        
        function switchAdminTab(tabId) {
            // Nascondi tutti i contenuti
            document.querySelectorAll('.admin-tab-content').forEach(el => {
                el.style.display = 'none';
                el.classList.remove('active');
            });
            
            // Disattiva tutti i bottoni
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Mostra contenuto target
            const target = document.getElementById(tabId);
            if(target) {
                target.style.display = 'block';
                target.classList.add('active');
            }

            // Attiva bottone
            const btns = document.querySelectorAll('.admin-tab-btn');
            btns.forEach(btn => {
                if(btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(tabId)) {
                    btn.classList.add('active');
                }
            });
            
            // Carica i dati della tab
            switch(tabId) {
                case 'admin-filosofi':
                    loadAdminFilosofi();
                    break;
                case 'admin-opere':
                    loadAdminOpere();
                    break;
                case 'admin-concetti':
                    loadAdminConcetti();
                    break;
            }
        }
        
        // Funzioni admin semplificate
        function openAdminPanel() {
            document.getElementById('top-menu-modal').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'flex';
            switchAdminTab('admin-filosofi');
        }
        
        function closeAdminPanel() {
            document.getElementById('admin-panel').style.display = 'none';
        }
        
        // Apri il menu modale
        function toggleMenuModal() {
            const modal = document.getElementById('top-menu-modal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }
        
        function closeMenuModal() {
            document.getElementById('top-menu-modal').style.display = 'none';
        }
        
        // QR Code
        function openQRModal() {
            document.getElementById('top-menu-modal').style.display = 'none';
            const modal = document.getElementById('qr-modal');
            const container = document.getElementById('qrcode-container');
            
            if (modal && container) {
                container.innerHTML = '';
                new QRCode(container, {
                    text: window.location.href,
                    width: 200,
                    height: 200,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
                modal.style.display = 'flex';
            }
        }
        
        function closeQRModal() {
            document.getElementById('qr-modal').style.display = 'none';
        }
        
        // Navigazione
        function openCreditsScreen() {
            document.getElementById('top-menu-modal').style.display = 'none';
            showScreen('credits-screen');
        }
        
        function openReportScreen() {
            document.getElementById('top-menu-modal').style.display = 'none';
            showScreen('segnalazioni-screen');
        }
        
        function inviaSegnalazione(event) {
            event.preventDefault();
            const tipo = document.getElementById('report-type').value;
            const descrizione = document.getElementById('report-desc').value;
    
            if (!descrizione.trim()) {
                showToast('Per favore, inserisci una descrizione', 'warning');
                return;
         }
    
         // Crea il testo della segnalazione con l'email
         const testoEmail = 
             `Tipo: ${tipo}\n` +
             `Descrizione: ${descrizione}\n` +
             `Data: ${new Date().toLocaleString()}\n` +
             `App: Aeterna Lexicon v4.0.0\n` +
             `URL: https://derolu0.github.io/aeterna/`;
    
         // Crea link mailto con l'indirizzo email specificato
         const mailtoLink = `mailto:derolu0@gmail.com?subject=Segnalazione Aeterna Lexicon&body=${encodeURIComponent(testoEmail)}`;
    
         // Mostra messaggio e apri client email
         showToast('Apertura client email...', 'info');
    
         // Apri il client email
         setTimeout(() => {
             window.open(mailtoLink, '_blank');
        
         // Mostra conferma
         setTimeout(() => {
            showToast('Grazie per la tua segnalazione!', 'success');
            
            // Resetta il form
            document.getElementById('report-desc').value = '';
            
            // Torna alla home dopo 3 secondi
            setTimeout(() => {
                showScreen('home-screen');
            }, 3000);
        }, 1000);
    }, 500);
}        
        // PWA
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            const banner = document.getElementById('pwa-install-banner');
            if (banner) {
                banner.style.display = 'flex';
            }
        });
        
        function installPWA() {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                deferredPrompt = null;
                
                const banner = document.getElementById('pwa-install-banner');
                if(banner) banner.style.display = 'none';
            });
        }
        
        // Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('‚úÖ Service Worker registrato'))
                    .catch(error => console.warn('‚ö†Ô∏è Service Worker non registrato:', error));
            });
        }
    </script>
</body>
</html>